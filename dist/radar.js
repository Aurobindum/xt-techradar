"use strict";function radar_visualization(t){function r(){var t=1e4*Math.sin(d++);return t-Math.floor(t)}function a(t){var r=t.x,a=t.y;return{t:Math.atan2(a,r),r:Math.sqrt(r*r+a*a)}}function e(t){return{x:t.r*Math.cos(t.t),y:t.r*Math.sin(t.t)}}function n(t,r,a){var e=Math.min(r,a),n=Math.max(r,a);return Math.min(Math.max(t,e),n)}function i(t,r,a){return{t:t.t,r:n(t.r,r,a)}}function l(t,r,a){return{x:n(t.x,r.x,a.x),y:n(t.y,r.y,a.y)}}function o(t,n){var o={t:c[t].radial_min*Math.PI,r:0==n?30:u[n-1].radius},s={t:c[t].radial_max*Math.PI,r:u[n].radius},d={x:15*c[t].factor_x,y:15*c[t].factor_y},f={x:u[2].radius*c[t].factor_x,y:u[2].radius*c[t].factor_y};return{clipx:function(t){var r=i(a(l(t,d,f)),o.r+15,s.r-15);return t.x=e(r).x,t.x},clipy:function(t){var r=i(a(l(t,d,f)),o.r+15,s.r-15);return t.y=e(r).y,t.y},random:function(){return e({t:function(t,a){return t+r()*(a-t)}(o.t,s.t),r:function(t,a){return t+.5*(r()+r())*(a-t)}(o.r,s.r)})}}}function s(t,r){return"translate("+t+","+r+")"}for(var d=42,c=[{radial_min:0,radial_max:.5,factor_x:1,factor_y:1},{radial_min:.5,radial_max:1,factor_x:-1,factor_y:1},{radial_min:-1,radial_max:-.5,factor_x:-1,factor_y:-1},{radial_min:-.5,radial_max:0,factor_x:1,factor_y:-1}],u=[{radius:130},{radius:220},{radius:310}],f=0;f<t.entries.length;f++){(m=t.entries[f]).segment=o(m.quadrant,m.ring);var y=m.segment.random();m.x=y.x,m.y=y.y,m.color=m.active||t.print_layout?t.rings[m.ring].color:t.colors.inactive}for(var p=new Array(t.quadrants.length),h=0;h<t.quadrants.length;h++){p[h]=new Array(t.quadrants.length);for(var x=0;x<u.length;x++)p[h][x]=[]}for(f=0;f<t.entries.length;f++){var m=t.entries[f];p[m.quadrant][m.ring].push(m)}for(var g=1,v=[2,3,1,0],_=0;_<v.length;_++)for(h=v[_],x=0;x<3;x++){var b=p[h][x];b.sort(function(t,r){return t.label.localeCompare(r.label)});for(f=0;f<b.length;f++)b[f].id=""+g++}var w=d3.select("svg#"+t.svg_id).style("background-color",t.colors.background).attr("width",t.width).attr("height",t.height),k=w.append("g");"zoomed_quadrant"in t?w.attr("viewBox",function(t){return[Math.max(0,400*c[t].factor_x)-420,Math.max(0,400*c[t].factor_y)-420,440,440].join(" ")}(t.zoomed_quadrant)):k.attr("transform",s(t.width/2,t.height/2));var M=k.append("g"),q=M.append("defs");for(f=u.length-1;f>=0;f--){var F=[0,-u[f].radius,0,-u[f].radius],z=[0,0,-u[f].radius,-u[f].radius],A=M.append("g").attr("clip-path","url(#quad"+f+")");q.append("clipPath").attr("id","quad"+f).append("circle").attr("cx",0).attr("cy",0).attr("r",u[f].radius);for(var P=0;P<t.quadrants.length;P++)A.append("rect").attr("x",F[P]).attr("y",z[P]).attr("width",u[f].radius).attr("height",u[f].radius).attr("stroke","#FFF").attr("stroke-width",0).attr("fill",t.quadrants[P].bgcolor).attr("fill-opacity",1/(f+1));M.append("circle").attr("cx",0).attr("cy",0).attr("r",u[f].radius).attr("stroke","#fff").attr("stroke-width",3).attr("fill","none"),t.print_layout&&M.append("text").text(t.rings[f].name).attr("y",62-u[f].radius).attr("text-anchor","middle").style("fill","#e5e5e5").style("font-family","Arial, Helvetica").style("font-size",30).style("font-weight","bold").style("pointer-events","none").style("user-select","none")}M.append("line").attr("x1",0).attr("y1",-310).attr("x2",0).attr("y2",310).style("stroke","#FFF").style("stroke-width",3),M.append("line").attr("x1",-310).attr("y1",0).attr("x2",310).attr("y2",0).style("stroke","#FFF").style("stroke-width",3);var B=k.append("g").attr("id","rink"),C=k.append("g").attr("id","bubble").attr("x",0).attr("y",0).style("opacity",0).style("pointer-events","none").style("user-select","none");C.append("rect").attr("rx",4).attr("ry",4).style("fill","#333"),C.append("text").style("font-family","sans-serif").style("font-size","10px").style("fill","#fff"),C.append("path").attr("d","M 0,0 10,0 5,8 z").style("fill","#333");var H=B.selectAll(".blip").data(t.entries).enter().append("g").attr("class","blip").on("mouseover",function(r){if(r.active||t.print_layout){var a=d3.select("#bubble text").text(r.label).node().getBBox();d3.select("#bubble").attr("transform",s(r.x-a.width/2,r.y-16)).style("opacity",.8),d3.select("#bubble rect").attr("x",-5).attr("y",-a.height).attr("width",a.width+10).attr("height",a.height+4),d3.select("#bubble path").attr("transform",s(a.width/2-5,3))}}).on("mouseout",function(t){d3.select("#bubble").attr("transform",s(0,0)).style("opacity",0)});H.each(function(r){var a=d3.select(this);if(!t.print_layout&&r.hasOwnProperty("link")&&(a=a.append("a").attr("xlink:href",r.link)),r.moved>0?a.append("path").attr("d","M -11,5 11,5 0,-13 z").style("fill",r.color):r.moved<0?a.append("path").attr("d","M -11,-5 11,-5 0,13 z").style("fill",r.color):a.append("circle").attr("r",9).attr("fill",r.color).attr("stroke","#FFF").attr("stroke-width",2),r.active||t.print_layout){var e=t.print_layout?r.id:r.label.match(/[a-z]/i);a.append("text").text(e).attr("y",3).attr("text-anchor","middle").style("fill","#fff").style("font-family","Arial, Helvetica").style("font-size",function(t){return e.length>2?"9":"10"}).style("pointer-events","none").style("user-select","none")}}),d3.forceSimulation().nodes(t.entries).velocityDecay(.19).force("collision",d3.forceCollide().radius(12).strength(.85)).on("tick",function(){H.attr("transform",function(t){return s(t.segment.clipx(t),t.segment.clipy(t))})})}